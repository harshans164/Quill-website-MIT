<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Newsletter - MIT Quill</title>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">
  <link href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.1/font/bootstrap-icons.css" rel="stylesheet">
  <style>
    body { background-color:#f8f9fa; }
    .container-title { text-align:center; margin:3rem 0 1.5rem 0; }
    .content-card { border-radius:12px; background:#ffffff; border:1px solid #e6edf5; }
    .news-ribbon { height:4px; background: linear-gradient(90deg, #0d6efd, #6ea8fe); }
    .badge-soft-primary { background-color:#e7f1ff; color:#0d6efd; border:1px solid #d3e3ff; }
    .article-content { white-space: pre-wrap; }
  </style>
</head>
<body>
  <div class="container">
    <div class="container-title">
      <a href="allnewsletter.html" class="btn btn-sm btn-outline-primary mb-3"><i class="bi bi-arrow-left"></i> Back to All</a>
      <h2 id="nlTitle">Newsletter</h2>
      <p class="text-muted" id="nlMeta"></p>
    </div>
    <div class="card shadow-sm content-card mb-5">
      <div class="news-ribbon"></div>
      <div class="p-4">
      <div class="d-flex justify-content-between mb-3">
        <span class="badge badge-soft-primary fw-bold">Newsletter</span>
        <span class="badge bg-light text-secondary" id="nlTime">Time</span>
      </div>
      <p class="lead" id="nlDescription"></p>
      <hr>
      <div class="article-content" id="nlContent"></div>
      </div>
    </div>
  </div>

  <script>
    (function(){
      const SHEET_ID = '1ebBDTG0IiRfjNNlMwPzYdfe6VLe3spRBS3sGX7_OyX8';
      const SHEET_NAME = 'Sheet1';
      const GVIZ_URL = `https://docs.google.com/spreadsheets/d/${SHEET_ID}/gviz/tq?tqx=out:json&sheet=${encodeURIComponent(SHEET_NAME)}`;
      function parseGviz(t){ const s=t.indexOf('(')+1,e=t.lastIndexOf(')'); const j=JSON.parse(t.substring(s,e)); return (j.table.rows||[]).filter(r=>r&&r.c).map(r=> r.c.map(c=> (c&&(c.f||c.v)) ? (c.f||c.v) : '')); }
      function formatDate(v){ try{ const d=new Date(v); if(!isNaN(d)) return d.toLocaleDateString(undefined,{year:'numeric',month:'long',day:'numeric'}); return v; }catch(_){ return v||'';} }
      function getId(){ const p=new URLSearchParams(window.location.search); const id=p.get('id'); return id!==null?parseInt(id,10):NaN; }

      fetch(GVIZ_URL).then(r=>r.text()).then(parseGviz).then(rows=>{
        const data = rows.filter(r => (r[0]||'').toString().trim().length>0 && r[0] !== 'Heading');
        let id=getId(); if(isNaN(id)||id<0||id>=data.length) id=data.length-1;
        const item=data[id];
        const title=item[0]||''; const desc=item[1]||''; const content=item[2]||''; const author=item[3]||'MIT Quill Team'; const date=item[4]||''; const time=item[5]||'';
        document.getElementById('nlTitle').textContent=title;
        document.getElementById('nlMeta').textContent=`${author}${author&&date?' â€¢ ':''}${formatDate(date)}`;
        document.getElementById('nlDescription').textContent=desc;
        document.getElementById('nlContent').textContent=content;
        document.getElementById('nlTime').textContent=time;
      }).catch(err=>console.error('Failed to load newsletter details', err));
    })();
  </script>
</body>
</html>

