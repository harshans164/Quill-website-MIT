<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>All Magazines - MIT Quill</title>
<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">
<link href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.1/font/bootstrap-icons.css" rel="stylesheet">
<style>
body {
  font-family: 'Roboto', sans-serif;
  background-color: #f8f9fa;
}

/* Back to Home button like articles */
.back-home-btn {
  color: #000;
  background-color: #fff;
  border: 1px solid #ccc;
  border-radius: 8px;
  padding: 0.4rem 1rem;
  transition: all 0.3s;
  text-decoration: none;
  display: inline-block;
  margin-bottom: 2rem;
}
.back-home-btn:hover {
  background-color: #fff8dc;
  border-color: #FFD700;
  color: #000;
  text-decoration: none;
}

/* Page header */
.page-header {
  padding: 3rem 1rem 2rem;
  text-align: center;
  background-color: #fff;
  margin-bottom: 2rem;
  box-shadow: 0 2px 8px rgba(0,0,0,0.05);
  border-radius: 12px;
}
.search-bar {
  max-width: 400px;
  margin: 1rem auto 2rem;
}

/* Magazine cards - article style */
.magazine-card {
  border-radius: 12px;
  transition: transform 0.3s ease, box-shadow 0.3s ease;
  background-color: #ffffff;
  border: 1px solid #ececec;
  border-left: 4px solid #FFD700;
  max-width: 520px;
  margin: auto;
}
.magazine-card:hover {
  transform: translateY(-4px);
  box-shadow: 0 10px 24px rgba(0,0,0,0.10);
}

.magazine-title {
  font-family: Georgia, 'Times New Roman', serif;
  font-weight: 700;
  letter-spacing: 0.2px;
  font-size: 1.1rem;
  margin-bottom: 0.5rem;
}

.badge-category {
  color: #FFD700;
  background-color: #fff8dc;
  font-size: 0.75rem;
  font-weight: bold;
  padding: 0.2rem 0.5rem;
  border-radius: 6px;
}

.card-text {
  margin-top: 0.5rem;
  margin-bottom: 0.5rem;
  min-height: 60px;
}

.author-date {
  font-size: 0.85rem;
  color: #6c757d;
  margin-bottom: 0.5rem;
}

.read-btn {
  font-size: 0.85rem;
  padding: 0.35rem 0.75rem;
  border-radius: 8px;
  transition: background-color 0.3s, color 0.3s, border-color 0.3s;
}
.read-btn:hover {
  background-color: #fff8dc;
  border-color: #FFD700;
  color: black;
}


mark {
  background-color: #fff3cd;
  padding: 0 2px;
}
</style>
</head>
<body>

<div class="container my-4">
  <a href="index.html" class="back-home-btn"><i class="bi bi-house-door"></i> Back to Home</a>

  <div class="page-header">
    <h1>All Magazines</h1>
    <p>Explore our complete collection of magazines and creative writing editions from MIT Quill.</p>
    <input id="magSearch" type="text" class="form-control search-bar" placeholder="Search magazines...">
  </div>

  <!-- Spinner -->
  <div class="text-center my-5" id="magazinesLoading">
    <div class="spinner-border text-warning" role="status">
      <span class="visually-hidden">Loading...</span>
    </div>
    <p class="mt-2">Loading magazines...</p>
  </div>

  <!-- Magazines row -->
  <div class="row g-4 justify-content-center" id="magazinesRow"></div>
  <div class="text-center text-muted my-4" id="magazinesEmpty" style="display:none;">No results</div>
</div>

<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"></script>
<script>
(function() {
  const SHEET_ID = '16b2aV3G4dimm7ENkD6KlJklPt2bXrc9LL7lt682Jv2c';
  const SHEET_NAME = 'Sheet1';
  const GVIZ_URL = `https://docs.google.com/spreadsheets/d/${SHEET_ID}/gviz/tq?tqx=out:json&sheet=${encodeURIComponent(SHEET_NAME)}`;

  function parseGviz(jsonpText) {
    const start = jsonpText.indexOf('(')+1;
    const end = jsonpText.lastIndexOf(')');
    const json = JSON.parse(jsonpText.substring(start, end));
    return (json.table.rows || []).filter(r => r && r.c)
      .map(r => r.c.map(c => (c && (c.f || c.v)) ? (c.f || c.v) : ''));
  }

  function formatDate(value) {
    try {
      const d = new Date(value);
      if (!isNaN(d)) return d.toLocaleDateString(undefined,{year:'numeric',month:'long',day:'numeric'});
      return value;
    } catch(e) { return value || ''; }
  }

  function escapeHtml(str) {
    return String(str).replace(/[&<>"']/g,ch=>({'&':'&amp;','<':'&lt;','>':'&gt;','"':'&quot;','\'':'&#39;'}[ch]));
  }

  function highlight(text, query) {
    if (!query) return escapeHtml(text);
    const safe = escapeHtml(text);
    const pattern = new RegExp(`(${query.replace(/[.*+?^${}()|[\\]\\]/g,'\\$&')})`,'ig');
    return safe.replace(pattern,'<mark>$1</mark>');
  }

function createCard(item, id, query) {
  const title = item[0] || '';
  const description = item[1] || '';
  const author = item[3] || '';
  const date = item[4] || '';
  const link = item[5] || '';

  const col = document.createElement('div');
  col.className = 'col-md-6 col-lg-4';

  col.innerHTML = `
    <div class="card magazine-card shadow-sm p-3">
      <div class="d-flex justify-content-between mb-2">
        <span class="badge badge-gold fw-bold"><i class="bi bi-journal-richtext"></i> Magazine</span>
      </div>
      <h5 class="card-title mt-1">${highlight(title, query)}</h5>
      <p class="card-text">${highlight(description, query)}</p>
      <p class="author-date">${highlight(author, query)}${author && date ? ' â€¢ ' : ''}${formatDate(date)}</p>
      <a href="${link}" class="btn btn-sm btn-outline-secondary read-btn align-self-start" target="_blank">Read Full Magazine</a>
    </div>`;
  
  return col;
}


  let allData = [];

  function renderList(list, query) {
    const container = document.getElementById('magazinesRow');
    const empty = document.getElementById('magazinesEmpty');
    container.innerHTML='';
    if(!list.length){ empty.style.display=''; return; }
    empty.style.display='none';
    list.forEach((item, idx)=> container.appendChild(createCard(item, idx, query)));
  }

  function attachSearch() {
    const input = document.getElementById('magSearch');
    if(!input) return;
    input.addEventListener('input', ()=>{
      const q = input.value.toLowerCase().trim();
      if(!q){ renderList(allData,''); return; }
      const filtered = allData.filter(r=>{
        const title = (r[0]||'').toString().toLowerCase();
        const desc = (r[1]||'').toString().toLowerCase();
        const author = (r[3]||'').toString().toLowerCase();
        return title.includes(q)||desc.includes(q)||author.includes(q);
      });
      renderList(filtered,q);
    });
  }

  fetch(GVIZ_URL)
    .then(r=>r.text())
    .then(text=>parseGviz(text))
    .then(rows=>{
      allData = rows.filter(r=>(r[0]||'').toString().trim().length>0 && r[0]!=='Heading');
      document.getElementById('magazinesLoading').style.display='none';
      renderList(allData,'');
      attachSearch();
    })
    .catch(err=>{
      console.error('Failed to load magazines from Google Sheets', err);
      document.getElementById('magazinesLoading').style.display='none';
    });
})();
</script>
</body>
</html>
